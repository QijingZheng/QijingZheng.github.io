<!DOCTYPE html>



<html lang="en-US" 
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    <meta name="pv-cache-enabled" content="false">

    
  

  <!-- for mathjax support -->
  
    
      <!-- MathJax 3 -->
<script>
  MathJax = {
    tex: {
      inlineMath:     [['$', '$'], ['\\(', '\\)']],
      displayMath:    [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      tags:           'ams'
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<!-- <script type="text/javascript" id="MathJax&#45;script" async -->
<!--   src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex&#45;mml&#45;chtml.js"> -->
<!-- </script> -->
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.1/es5/tex-mml-chtml.min.js"
  integrity="sha512-lt3EkmQb16BgAXR0iCk+JUJyDFmS9NZEMXCXK169qQoWcXu9CS4feejtxkjjUruw/Y0XfL1qxh41xVQPvCxM1A=="
  crossorigin="anonymous" referrerpolicy="no-referrer">
</script>
<!-- <script type="text/javascript" id="MathJax&#45;script" async -->
<!--         src='/assets/mathjax3/es5/tex&#45;mml&%2345;chtml.js'> -->
<!-- </script> -->

<!-- <script type="text/javascript" id="MathJax&#45;script" async -->
<!--   src='/assets/js/lib/tex&#45;mml&%2345;chtml.js'> -->
<!-- </script> -->

    
  

  <!-- for video.js support -->
  

  <!-- for plotly support -->
  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Numerical Solutions to the Time-dependent Schrödinger Equation" />
<meta name="author" content="Qijing Zheng" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." />
<meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." />
<link rel="canonical" href="https://qijingzheng.github.io/posts/Numerical_TDSE/" />
<meta property="og:url" content="https://qijingzheng.github.io/posts/Numerical_TDSE/" />
<meta property="og:site_name" content="Qijing Zheng" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-20T09:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Numerical Solutions to the Time-dependent Schrödinger Equation" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://qijingzheng.github.io/posts/Numerical_TDSE/","headline":"Numerical Solutions to the Time-dependent Schrödinger Equation","dateModified":"2022-05-20T09:00:00+08:00","datePublished":"2022-05-20T09:00:00+08:00","author":{"@type":"Person","name":"Qijing Zheng"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://qijingzheng.github.io/posts/Numerical_TDSE/"},"description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Numerical Solutions to the Time-dependent Schrödinger Equation | Qijing Zheng
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://www.favicon-generator.org/
-->



<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">
<link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon">

<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png">
<link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png">
<link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png">

<link rel="icon" type="image/png" sizes="192x192"  href="/assets/img/favicons/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

<link rel="manifest" href="/assets/img/favicons/manifest.json">
<meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'>
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
  

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <!-- <link rel="stylesheet" -->
  <!--   href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" -->
  <!--   integrity="sha256&#45;LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"> -->
  <link rel="stylesheet" href='/assets/css/bootstrap.min.css'>

  <!-- Font Awesome -->
  <!-- <link rel="stylesheet" -->
  <!--   href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome&#45;free@5.11.2/css/all.min.css" -->
  <!--   integrity="sha256&#45;+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" -->
  <!--   crossorigin="anonymous"> -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
        integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href='/assets/css/bootstrap-toc.css'>



  <!-- for video.js support -->
  

  <!-- JavaScripts -->

  <script src='/assets/js/dist/jquery.min.js'></script>

  <script defer
    src='/assets/js/dist/bootstrap.min.js'></script>

  <!--
  JS selector for site.
-->


  





<script defer src="/assets/js/dist/post.min.js"></script>






  
      <link rel="stylesheet"
  href="/assets/lightbox2/css/lightbox2.css" />
<link rel="stylesheet"
  href="/assets/splide/css/splide-skyblue.min.css" />

<script src="/assets/lightbox2/js/lightbox-plus-jquery.min.js" ></script>
<script type="text/javascript">
    lightbox.option({
        'alwaysShowNavOnTouchDevices' : true,
        'resizeDuration': 200,
        'wrapAround': true
    })
</script>

<script src="/assets/splide/js/splide.min.js"></script>
<script type="text/javascript">
    document.addEventListener( 'DOMContentLoaded', function () {
        new Splide( '#image-slider',
            {
                type: 'loop',
                perPage: 1,
                rewind:    false,
                gap: 2,
                autoplay: true,
            }
        ).mount();
    } );
</script>

  



</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end">

  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/me/profile_redeye.gif" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Qijing Zheng</a>
    </div>

    <div class="site-subtitle font-italic"><div style="height: 6px"> </div>
Associate Professor <br />
<div style="height: 6px"> </div>
Department of Physics <br />
<div style="height: 6px"> </div>
University of Science &amp; Technology of China 
<div style="height: 12px"> </div></div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i>
        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/members/" class="nav-link">
        <i class="fa-fw fas fa-user ml-xl-3 mr-xl-3 unloaded"></i>
        <span>MEMBERS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/publication/" class="nav-link">
        <i class="fa-fw fas fa-newspaper ml-xl-3 mr-xl-3 unloaded"></i>
        <span>PUBLICATIONS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/post/" class="nav-link">
        <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i>
        <span>POSTS</span>
      </a>
    </li> <!-- .nav-item -->
    
    <li class="nav-item">
      <a href="/link/" class="nav-link">
        <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i>
        <span>LINKS</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div style="padding-left: 0px" class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      <span id="mode-toggle-wrapper" class="ml-auto order-0">
        <!--
  Switch the mode between dark and light.
-->

<i class="mode-toggle fas fa-adjust"></i>

<script type="text/javascript">

  class ModeToggle {
    static get MODE_KEY() { return "mode"; }
    static get DARK_MODE() { return "dark"; }
    static get LIGHT_MODE() { return "light"; }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      var self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addListener(function() {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }

          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.updateMermaid();
      });

    } /* constructor() */


    setDark() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      $('html').removeAttr(ModeToggle.MODE_KEY);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); }

    get isSysDarkPrefer() { return this.sysDarkPrefers.matches; }

    get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; }

    get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; }

    get hasMode() { return this.mode != null; }

    get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode
        || (!this.hasMode && this.isSysDarkPrefer) ) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    updateMermaid() {
      if (typeof mermaid !== "undefined") {
        let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default");
        let config = { theme: expectedTheme };

        /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $(".mermaid").each(function() {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr("data-processed");
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, ".mermaid");
      }
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }

        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }

      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.updateMermaid();

    } /* flipMode() */

  } /* ModeToggle */

  let toggle = new ModeToggle();

  $(".mode-toggle").click(function() {

    toggle.flipMode();

  });

</script>

      </span>

      
        <span class="icon-border order-1"></span>
      

    

    
      

      
      <a href="https://github.com/QijingZheng" aria-label="github"
        
          class="order-3"
          target="_blank" rel="noopener">
        
        <i class="fab fa-github-alt"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['zqj','ustc.edu.cn'].join('@')" aria-label="email"
        
          class="mr-auto order-4"
          >
        
        <i class="fas fa-envelope"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->


</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<div id="topbar-wrapper" class="row justify-content-center topbar-down">
  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">
    <span id="breadcrumb">

    

    

      

        
          

        

      

        
        <span>
          
          
          <a href="/">
            Posts
          </a>
        </span>

        

      

        
          <span>Numerical Solutions to the Time-dependent Schrödinger Equation</span>

        

      

    

    </span><!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      Post
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input class="form-control" id="search-input" type="search"
        aria-label="search" placeholder="Search...">
      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>
    </span>
    <span id="search-cancel" >Cancel</span>
  </div>

</div>


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->


<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->


<!-- Add attribute 'hide-bullet' to the checkbox list -->




  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->
  
  

  

  



<!-- return -->
<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Numerical Solutions to the Time-dependent Schrödinger Equation</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <!--
  Date format snippet
-->





<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Fri, May 20, 2022,  9:00 AM +0800"
  >

  
  

  
    May 20
  

  <i class="unloaded">2022-05-20T09:00:00+08:00</i>

</span>

          by
          <span class="author">
            Qijing Zheng
          </span>
        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->


<!-- words per minute  -->







<!-- return element -->
<span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4348 words">24 min</span>


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        
<h2 id="time-dependent-schrödinger-equation">Time-dependent Schrödinger Equation</h2>

<p>The single-particle time-dependent Schrödinger equation of an electron under an
external potential read</p>

\[\begin{align}
i\hbar \frac{\partial}{\partial t} \psi(\mathbf{r}, t) &amp;= {\cal H}(\mathbf{r};t)\,\psi(\mathbf{r}, t)
                                                        = [\hat{T} + \hat{V}]\,\psi(\mathbf{r}, t) \\
&amp;=\left[
    -\frac{\hbar^2}{2m}\nabla^2 + \hat{V}(\mathbf{r})
\right]\psi(\mathbf{r}, t)
\end{align}\]

<p>In the atomic unit ($\hbar = m_e = e = a_0 = 1$), <sup id="fnref:atomic_unit" role="doc-noteref"><a href="#fn:atomic_unit" class="footnote">1</a></sup> the equation becomes</p>

\[\begin{equation}
i \frac{\partial}{\partial t} \psi(\mathbf{r}, t) = \left[
    -\frac{1}{2}\nabla^2 + \hat{V}(\mathbf{r})
\right]\psi(\mathbf{r}, t)
\end{equation}\]

<p>The formal solution to the Schrödinger equation</p>

\[\begin{equation}
\psi(\mathbf{r}, t+\Delta t) =
    e^{-i{\cal H}\cdot \Delta t}\,\psi(\mathbf{r}, t) = 
    {\cal U}(\Delta t)\,\psi(\mathbf{r}, t) 
\end{equation}\]

<p>Note that ${\cal U}(t)$ is a <em>unitary operator</em>, which means that the <em>norm of
wavefunction is conserved</em> during the time propagation. Therefore, we can use
the norm of the wavefunction as an indicator of the time evolution.</p>

<p>If, for example, ${\cal H}$ is <em>time-independent</em> and $\phi_k(\mathbf{r})$ are
the corresponding eigenfunctions with eigenvalue $\varepsilon_k$, then one can
expand the time-dependent wavefunctions $\psi_j(\mathbf{r}, t)$ by $\phi_k$,
i.e.</p>

\[\begin{equation}
\psi_j(\mathbf{r}, t) = \sum_k c_k(t)\phi_k(\mathbf{r})
\end{equation}\]

<p>As a result, we have</p>

\[\begin{equation}
\psi_j(\mathbf{r}, t) = e^{-i{\cal H}\cdot t}\,\psi_j(\mathbf{r}, 0)
                      = \sum_k e^{-i\varepsilon_k t}\,c_k(0)\phi_k(\mathbf{r})
\end{equation}\]

<h2 id="crank-nicolson-method">Crank-Nicolson Method</h2>

<p>The Crank-Nicolson method<sup id="fnref:cranknicolson" role="doc-noteref"><a href="#fn:cranknicolson" class="footnote">2</a></sup> is a combination of <em>forward-Euler
method</em> and <em>backward-Euler method</em>.</p>

<ul>
  <li>
    <p>Fowrard-Euler Method</p>

\[\begin{equation}
\label{eq:f_euler}
\psi_j^{n+1} = e^{-i{\cal H}\Delta t}\cdot \psi_j^n
            \approx (1 - i{\cal H}\Delta t)\cdot \psi_j^n
\end{equation}\]
  </li>
  <li>
    <p>Backward-Euler Method</p>

\[\begin{equation}
\label{eq:b_euler}
e^{i{\cal H}\Delta t}\cdot \psi_j^{n+1}=\psi_j^n
\quad\Rightarrow\quad
(1 + i{\cal H}\Delta t)\cdot \psi_j^{n+1} \approx \psi_j^n
\end{equation}\]
  </li>
  <li>
    <p>Crank-Nicolson Method</p>

\[\begin{align}
\psi_j^{n+1} = \dfrac{
  e^{-i{\cal H}\Delta t/2}
}{
  e^{i{\cal H}\Delta t/2}
}\cdot \psi_j^n 
&amp;\approx
\dfrac{
  (1 - i{\cal H}\Delta t/2)
}{
  (1 + i{\cal H}\Delta t/2)
}\cdot \psi_j^n \\[9pt]
{\cal U}(\Delta t) &amp; =\dfrac{
  (1 - i{\cal H}\Delta t/2)
}{
  (1 + i{\cal H}\Delta t/2)
}
\label{eq:cn_cayley_form}
\end{align}\]

    <p>The approximation form to the unitary operator in Eq.\eqref{eq:cn_cayley_form}
is also known as <em>Cayley’s form</em>. We can also write the above equation as</p>

\[\begin{equation}
\label{eq:cn_form2}
(1 + i{\cal H}\Delta t/2)\cdot \psi_j^{n+1}
\approx
(1 - i{\cal H}\Delta t/2)\cdot \psi_j^n 
\end{equation}\]

    <p>Apparently, the equation above can also be obtained by combining
Eq.\eqref{eq:f_euler} and \eqref{eq:b_euler}. Note, however, that the method
itself is not simply the average of those two methods, as the backward-Euler
equation has an implicit dependence on the solution. Moreover, the
Crank-Nicolson method is a <em>unitary</em> method, which conserves the norm
of the wavefunction, as opposed to the forward- and backward-Euler methods.</p>
  </li>
</ul>

<h3 id="discretization-of-the-wavefunction">Discretization of the Wavefunction</h3>

<ul>
  <li>
    <p>In order to solve the equation numerically, let’s first discretize the
wavefunction in space and time, equally spaced by $\Delta r$ and $\Delta t$,
respectively. Then, denote the wavefunction at $\mathbf{r}_j$ and $t_n = n
\cdot \Delta t + t_0$ as $\psi_j^n$. Note that $j$ here is a compound index
representing the index of the space grid, e.g. $(j, k, l)$ in 3D case.</p>
  </li>
  <li>
    <p>The time derivative</p>

\[\begin{equation}
\frac{\partial\psi(\mathbf{r}_j, t^n)}{\partial t}
\approx
\frac{\psi_j^{n+1} - \psi_j^n}{\Delta t}
\end{equation}\]
  </li>
  <li>
    <p>The spatial derivative <sup id="fnref:finite_diff" role="doc-noteref"><a href="#fn:finite_diff" class="footnote">3</a></sup></p>

\[\begin{equation}
\label{eq:spatial_deriv}
\nabla^2 \psi(\mathbf{r}_j, t^n)
\approx
\frac{\psi_{j+1}^n + \psi_{j-1}^n- 2\cdot\psi_j^n}{(\Delta r)^2}
\end{equation}\]

    <p>Note that the index $j$ should be considered as a compound index. For example,
in a 2-dimensional grid, the space derivative in the $x/y$ directions</p>

\[\begin{align}
\nabla_x^2 \psi(\mathbf{r}_{j,k}, t^n) &amp;\approx
    \frac{\psi_{j+1,k}^n + \psi_{j-1,k}^n- 2\cdot\psi_{j,k}^n}{(\Delta x)^2} \\
\nabla_y^2 \psi(\mathbf{r}_{j,k}, t^n) &amp;\approx
    \frac{\psi_{j,k+1}^n + \psi_{j,k-1}^n- 2\cdot\psi_{j,k}^n}{(\Delta y)^2}
\end{align}\]
  </li>
</ul>

<h3 id="1d-schrödinger-equation">1D Schrödinger Equation</h3>

<p>Suppose the potential/wavefunction is defined on a set of $J + 1$ spatial grids
points $x_j = x_0 + j \Delta x$, with $j \in [0, J]$ and $x_0$ representing the
left boundary.</p>

<ul>
  <li>
    <p>Let’s represent the wavefunction at time $t^n$ and $t^{n+1}$ as column
vectors, i.e.</p>

\[\begin{align}
\Psi^n &amp;=
\begin{bmatrix}
    \psi_0^n&amp; \psi_1^n&amp; \psi_2^n&amp; \cdots&amp; \psi_J^n
\end{bmatrix}^T \\[6pt]
\Psi^{n+1} &amp;=
\begin{bmatrix}
    \psi_0^{n+1}&amp; \psi_1^{n+1}&amp; \psi_2^{n+1}&amp; \cdots&amp; \psi_J^{n+1}
\end{bmatrix}^T
\end{align}\]
  </li>
  <li>
    <p>From Eq.\eqref{eq:spatial_deriv}, one can readily see that the kinetic
operator $\hat{T}$ can be represented by a tri-diagonal matrix of order $J+1$,
i.e.</p>

\[\begin{equation}
T = -\dfrac{1}{2}\nabla^2 = -\dfrac{1}{2\Delta x^2} \cdot
\begin{bmatrix}
    -2&amp; 1&amp; 0&amp; 0&amp; \ldots&amp; 0&amp; 0&amp; 0 \\
    1&amp; -2&amp; 1&amp; 0&amp; \ldots&amp; 0&amp; 0&amp; 0 \\
    0&amp; 1&amp; -2&amp; 1&amp; \ldots&amp; 0&amp; 0&amp; 0 \\
    \vdots&amp; \vdots&amp; \vdots&amp; \vdots&amp; \vdots&amp; \vdots&amp; \vdots&amp; \vdots \\
    0&amp; 0&amp; 0&amp; 0&amp; \ldots&amp; 1&amp; -2&amp; 1 \\
    0&amp; 0&amp; 0&amp; 0&amp; \ldots&amp; 0&amp; 1&amp; -2 \\
\end{bmatrix}
\end{equation}\]

    <p>Note that by writing in this form, we are implicitly assuming <em>zero-boundary
condition</em>, i.e. $\psi(x_0, t^n) = 0$ and $\psi(x_J, t^n) = 0$. Or in other
words, the values of the potential at the boundaries are <em>infinite</em>.</p>
  </li>
  <li>
    <p>The potential operator $\hat{V}$, on the other hand, is a diagonal matrix.</p>

\[\begin{equation}
V = \mathrm{Diag}
  \begin{bmatrix}
      v_0&amp; v_1&amp; v_2&amp; \cdots&amp; v_J
  \end{bmatrix}
\end{equation}\]
  </li>
  <li>
    <p>The Crank-Nicolson method in Eq.\eqref{eq:cn_form2} in matrix form can then be
obtained</p>

\[\begin{align}
\label{eq:cn_mat_form}
    U_2\cdot \Psi^{n+1} &amp;= U_1\cdot \Psi^n \\[9pt]
    U_2 &amp;= \mathbb{I} + \dfrac{i\Delta t}{2}\cdot [T + V] \label{eq:cn_mat_u2} \\[6pt]
    U_1 &amp;= \mathbb{I} - \dfrac{i\Delta t}{2}\cdot [T + V] \label{eq:cn_mat_u1} 
\end{align}\]

    <p>where $\mathbb{I}$ in Eq.\eqref{eq:cn_mat_u2} and \eqref{eq:cn_mat_u1} is an
indentity matrix of order $J+1$.  Eq.\eqref{eq:cn_mat_form} is of the form of
a linear equation $A\cdot x = b$, which can be solved by using, for example
<code class="language-plaintext highlighter-rouge">scipy.sparse.linalg.spsolve</code> in python, given that $U_2$ and $U_1$ are sparse
matrices.  An example code using python can be found below.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1"># JxN array to store all the wavefunctions
</span><span class="n">PSI</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span> 
<span class="c1"># initial wavefunction
</span><span class="n">PSI</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>
<span class="c1"># LU decomposition of U2
</span><span class="n">LU</span>  <span class="o">=</span> <span class="n">scipy</span><span class="p">.</span><span class="n">sparse</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="n">splu</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span>
<span class="c1"># Crank-Nicolson evolution
</span><span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># U1 apply on wavefunction at t^n
</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">U1</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI</span><span class="p">[:,</span><span class="n">tt</span><span class="p">])</span>
    <span class="c1"># wavefunction at next step
</span>    <span class="n">PSI</span><span class="p">[:,</span><span class="n">tt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LU</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ul>

<h3 id="1d-gaussian-wavepacket-in-an-infinite-well-potential">1D Gaussian Wavepacket in an Infinite-well Potential</h3>

<p>Let’s first look at the case for $V(x) = 0$, where $x\in[-L/2, L/2]$. As we have
stated above, this does not mean that the wavefunction propagates in a free
space. Rather, it is a infinitly deep well, since we are adopting a
<em>zero-boundary condition</em>.</p>

<p>The initial wavefunction is chosen to be a Gaussian wavepacket<sup id="fnref:wavepacket" role="doc-noteref"><a href="#fn:wavepacket" class="footnote">4</a></sup>
centered at $x_0$ and with average momentum $k_0$, which is given by</p>

\[\begin{equation}
  \psi_0(x) =
  \dfrac{1}{\sqrt[4]{\pi\sigma_x^2}}
  \cdot
  e^{i\cdot k_0(x - x_0)}
  \cdot
  e^{-\frac{(x - x_0)^2}{2\sigma_x^2}}
\end{equation}\]

<p>The <code class="language-plaintext highlighter-rouge">python</code> codes are shown below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre>  <span class="c1">#!/usr/bin/env python
</span>  
  <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
  <span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="n">spa</span>
  <span class="kn">from</span> <span class="nn">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">splu</span>
  <span class="c1">################################################################################
</span>  
  <span class="k">def</span> <span class="nf">gaussian_wavepacket</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
      <span class="s">'''
      One dimensional Gaussian wavepacket
      '''</span>
  
      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  
      <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">))</span> <span class="o">*</span> <span class="n">g</span>
  
  <span class="k">def</span> <span class="nf">CrankNicolson</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">print_norm</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
      <span class="s">'''
      Crank-Nicolson method for the 1D Schrodinger equation.
      '''</span>
      <span class="c1"># No. of spatial grid points
</span>      <span class="n">J</span>  <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
      <span class="c1"># the external potential
</span>      <span class="n">V</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">diags</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
      <span class="c1"># the kinetic operator
</span>      <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">spa</span><span class="p">.</span><span class="n">spdiags</span><span class="p">([</span><span class="n">O</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">O</span><span class="p">,</span> <span class="n">O</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  
      <span class="c1"># the two unitary matrices
</span>      <span class="n">U2</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span>
      <span class="n">U1</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">eye</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span>
      <span class="c1"># splu requires CSC matrix format for efficient decomposition
</span>      <span class="n">U2</span> <span class="o">=</span> <span class="n">U2</span><span class="p">.</span><span class="n">tocsc</span><span class="p">()</span>
      <span class="n">LU</span> <span class="o">=</span> <span class="n">splu</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span>
  
      <span class="c1"># Store all the wavefunctions
</span>      <span class="n">PSI_t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
      <span class="c1"># the initial wavefunction
</span>      <span class="n">PSI_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>
  
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">b</span>            <span class="o">=</span> <span class="n">U1</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">])</span>
          <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">LU</span><span class="p">.</span><span class="n">solve</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">print_norm</span><span class="p">:</span>
              <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
  
      <span class="k">return</span> <span class="n">PSI_t</span>
</pre></td></tr></tbody></table></code></div></div>

<ul>
  <li>
    <p>A rather important parameter for integrating the Schrödinger equation is the
time step $\Delta t$. As can be seen below, with average wavepacket momentum
$k_0 = 0$, the result from $\Delta t= 0.01$ already gives a reasonable result,
as compared to that of $\Delta t = 0.001$.</p>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/cranknicolson_diff_time_steps_k0.png" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/cranknicolson_diff_time_steps_k0.png" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: justify; padding: 10px">
      
    <b> Figure 1. </b>
    Left: Wavefunctions at $t = 1.0\,$a.u. from Crank-Nicolson method with
    different time steps. Right: Differences of the wavefunctions.  The average
    momentum of the Gaussian wavepacket $k_0 = 0$ and the width of the packet
    width $\sigma_x = 0.4$, both in atomic units.
    Figure generated by 
    <a href="/assets/posts/numeric_tdse/cn_diff_dts.py">
    this script.
    </a>
  </figcaption>
</figure>

    <p>As is well known that the Fourier transform of a Gaussian function is also a
Gaussian, i.e.</p>

\[\begin{equation}
{\cal F}[\psi_0(x)](k) = c\cdot e^{-\frac{(k-k_0)^2}{2\sigma_k^2}};
\quad 
\sigma_k = 2\pi / \sigma_x
\end{equation}\]

    <p>where $c$ is a normalization factor. The above equation shows that the
Gaussian wavepacket can be expanded by plane waves with amplitude also being a
Gaussian. The spread of the plane wave momentum mainly locates within $k\in
[k_0-\sigma_k, k_0 + \sigma_k]$. Therefore, by considering the plane waves
with $k = k_0 + \sigma_k$, the time step can be approximated by</p>

\[\begin{equation}
\Delta t \approx 1 / E_k = \left[\frac{(k + \sigma_k)^2}{2}\right]^{-1}
\end{equation}\]

    <p>For $k_0 = 0$ and $\sigma_x = 0.4$, the equation gives $\Delta t = 0.008$,
which is consistent with our test. Apparently, with <em>larger</em> wavepacket momentum
$k_0$ and <em>smaller</em> packet width $\sigma_x$, the reasonable time step will
become smaller.</p>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/cranknicolson_diff_time_steps_k10.png" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/cranknicolson_diff_time_steps_k10.png" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: justify; padding: 10px">
      
    <b> Figure 2. </b>
    Left: Wavefunctions at $t = 1.0\,$a.u. from Crank-Nicolson method with
    different time steps. Right: Differences of the wavefunctions.  The
    average momentum of the Gaussian wavepacket $k_0 = 10$, the width of the
    packet width $\sigma_x = 0.4$ and the converged time step is estimated to
    be $\Delta t = 0.003$, all in atomic units. 
  </figcaption>
</figure>
  </li>
  <li>
    <p>Evolution of the wavepacket with different average momentum $k_0$.</p>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/wavepacket_momentum_0.png" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/wavepacket_momentum_0.png" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: center; padding: 10px">
      
    <b> Figure 3. </b>
    Evolution of the wavepacket with $k_0 = 0$.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn_diff_initK.py">
    this script.
    </a>
  </figcaption>
</figure>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/wavepacket_momentum_1.png" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/wavepacket_momentum_1.png" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: center; padding: 10px">
      
    <b> Figure 4. </b>
    Evolution of the wavepacket with $k_0 = 1$.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn_diff_initK.py">
    this script.
    </a>
  </figcaption>
</figure>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/wavepacket_momentum_5.png" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/wavepacket_momentum_5.png" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: center; padding: 10px">
      
    <b> Figure 5. </b>
    Evolution of the wavepacket with $k_0 = 5$.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn_diff_initK.py">
    this script.
    </a>
  </figcaption>
</figure>
  </li>
  <li>
    <p>Animation of time propagation of Gaussian wavepacket with different initial momenta $k_0
= 0$ and $k_0 = 10$ a.u.</p>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/gaus_wfc_ks_fill_2x1.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/gaus_wfc_ks_fill_2x1.gif" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: center; padding: 10px">
      
    <b> Figure 6. </b>
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn_anim_fill_2x1.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>
  </li>
  <li>
    <p>Animation of time propagation of Gaussian wavepacket in the existence of a
finite barrier with different barrier height $V_0 = 10$ and $V_0 = 100$ a.u.
The barrier width is set to 2 a.u.</p>

    <figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/gaus_wfc_bar_2x1.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/gaus_wfc_bar_2x1.gif" width="95%" />
    </a>
  </div>
  
  <figcaption style="text-align: center; padding: 10px">
      
    <b> Figure 7. </b>
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn_bar_anim_2x1.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>

    <p>As can be clearly seen, when the barrier height is modest (10 a.u.), quantum
tunnelling can be observed. However, when the barrier is set to a rather high
value (100 a.u.), tunneling can be hardly seen.</p>
  </li>
</ul>

<p>For solution to higher dimensional Schrödinger equation, one can referred to the
QMsolve code. <sup id="fnref:qmsolve" role="doc-noteref"><a href="#fn:qmsolve" class="footnote">5</a></sup></p>

<h2 id="runge-kutta-method">Runge-Kutta Method</h2>

<p>For an initial value equation,</p>

\[\dfrac{\mathrm{d}y}{\mathrm{d}t} = f(t, y)\]

<p>The 4-th order Runge-Kutta (RK4) method<sup id="fnref:rungekutta" role="doc-noteref"><a href="#fn:rungekutta" class="footnote">6</a></sup> gives</p>

\[\begin{equation}
y^{n+1} = y^n + \frac{1}{6}\cdot(k_1 + 2k_2 + 2k_3 + k_4)
\end{equation}\]

<p>where</p>

\[\begin{align}
k_1 &amp;= \Delta t \cdot f(t^n, y^n) \\
k_2 &amp;= \Delta t \cdot f(t^n + \frac{\Delta t}{2}, y^n + \frac{k_1}{2}) \\
k_3 &amp;= \Delta t \cdot f(t^n + \frac{\Delta t}{2}, y^n + \frac{k_2}{2}) \\
k_4 &amp;= \Delta t \cdot f(t^n + \Delta t, y^n + k_3) \\
\end{align}\]

<p>The python code for the 1D Schrodinger equation using Runge-Kutta method can be
written as follows.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">RungeKutta</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">print_norm</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">'''
    4th-order Runge-Kutta method for the 1D Schrodinger equation.
    '''</span>
    <span class="c1"># No. of spatial grid points
</span>    <span class="n">J</span>  <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># the external potential
</span>    <span class="n">V</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">diags</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="c1"># the kinetic operator
</span>    <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">spa</span><span class="p">.</span><span class="n">spdiags</span><span class="p">([</span><span class="n">O</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">O</span><span class="p">,</span> <span class="n">O</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1j</span><span class="o">*</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span>

    <span class="c1"># Store all the wavefunctions
</span>    <span class="n">PSI_t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># the initial wavefunction
</span>    <span class="n">PSI_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">U</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">])</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">U</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
        <span class="n">k3</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">U</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">)</span>
        <span class="n">k4</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">U</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">k3</span><span class="p">)</span>

        <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span> <span class="o">/</span> <span class="mf">6.</span>
        <span class="k">if</span> <span class="n">print_norm</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">PSI_t</span>
</pre></td></tr></tbody></table></code></div></div>

<figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/comp_cn-rk4.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/comp_cn-rk4.gif" width="95%" />
    </a>
  </div>

  <figcaption style="text-align: center; padding: 10px">
    
    <b> Figure 8. </b>
    Propagation of Gaussian wavepacket from Crank-Nicolson and 4-th order
    Runge-Kutta method.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn-rk_comp_anim.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>

<ul>
  <li>As can be seen, although the results from RK4 and Crank-Nicolson method match
fairly well, the time step for the RK4 method is much smaller than that used in
the Crank-Nicolson method. For a larger time step, e.g. 0.0008, the
norm of wavefunction from RK4 method will diverge.</li>
</ul>

<h2 id="polynomial-methods">Polynomial Methods</h2>

<p>In the polynomial methods, the propagator ${\cal U}(\Delta t)$ is approximated
by</p>

\[\begin{equation}
{\cal U}(\Delta t) = e^{-i{\cal H}\cdot\Delta t} \approx \sum_n a_n P_n({\cal H})
\end{equation}\]

<p>where $P_n(\cal H)$ is a polynomial of the Hamiltonian operator $\cal H$, whose
operation on the wavefunction $\psi$ can be evaluated by interation of $\cal H$
on $\psi$. For example, if we know how to calculate ${\cal H}\cdot\psi$, then we
can calculate ${\cal H}^2\cdot\psi = {\cal H}\cdot({\cal H}\cdot\psi)$ and
finally ${\cal H}^n\cdot\psi$.</p>

<h3 id="chebyshev-polynomials">Chebyshev polynomials</h3>

<p>On can of course use Taylor expansion to expand ${\cal U}(\Delta t)$, however, a better
choice is to use the Chebyshev polynomials. <sup id="fnref:chebyshev" role="doc-noteref"><a href="#fn:chebyshev" class="footnote">7</a></sup></p>

\[\begin{equation}
e^{-i{\cal H}\cdot \Delta t} = J_0(\tau) \cdot \mathbb{I}
                             + \sum_{n=1}^\infty (-i)^n \, J_n(\tau) \, T_n(H)
\end{equation}\]

<p>where $\mathbb{I}$ is the indentity operator, $J_n$ is the <em>Bessel</em> function of
the first kind of order $n$,<sup id="fnref:scipy_bessel_jv" role="doc-noteref"><a href="#fn:scipy_bessel_jv" class="footnote">8</a></sup> $T_n$ is the first-kind
<em>Chebyshev</em> polynomial of degreen $n$. The dimensionless time $\tau$ and
dimensionless Hamiltonian $H$ are defined as</p>

\[\begin{equation}
\tau = \|{\cal H}\| \cdot \Delta t,
\qquad
H = \dfrac{\cal H}{\|{\cal H}\|}
\end{equation}\]

<p>The norm $\|\cdot\|$ is chosen such that $\|T_n(H)\|\le 1$ and $H \in [-1,
1]$ for all $n$.  A reasonable choice is the <em>maximum</em> matrix element of
$\|{\cal H}\| = {\cal H}_{max}$. As $J_n(\tau)| \le \tau^n / 2^n n!$, the
series converges rapidly for any fixed $\tau$, therefore, we can truncate the
expansion at some finite $n = N$.</p>

<p><strong>Note</strong> how the dimensionless time $\tau$ depend on the time step $\Delta t$
and $\|{\cal H}\|$, which again depends on $\Delta x$ and $V$. As a result,
for a chosen accuracy, the truncation $N$ also depends on the time and spatial
step.</p>

<p>The numerical evaluation of the operators $T_n(H)$ is straightforward in view of
the following recurrence relation:</p>

\[\begin{align}
  T_0(H) &amp;= \mathbb{I} \\
  T_1(H) &amp;= H \\
  T_n(H) &amp;= 2H\cdot T_{n-1}(H) - T_{n-2}(H)
\end{align}\]

<p>As a result,</p>

\[\begin{equation}
\psi(t+\Delta t) \approx J_0(\tau)\cdot\psi_0(t) + 2\sum_{n=1}^N (-i)^n J_n(\tau) \psi_n(t)
\end{equation}\]

<p>where</p>

\[\begin{align}
  \psi_0(t) &amp;= \psi(t) \\
  \psi_1(t) &amp;= H\cdot\psi_0(t) \\
  \psi_n(t) &amp;= 2H\cdot \psi_{n-1}(t) - \psi_{n-2}(t)
\end{align}\]

<p>The <code class="language-plaintext highlighter-rouge">python</code> code implementation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">ChebyshevPoly</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">1E-6</span><span class="p">,</span> <span class="n">print_norm</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">'''
    Chebyshev polynomial expansion for the 1D Schrodinger equation.
    '''</span>
    <span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">j0</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">jv</span>

    <span class="c1"># No. of spatial grid points
</span>    <span class="n">J</span>  <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">Hmax</span>   <span class="o">=</span> <span class="n">V</span><span class="p">.</span><span class="nb">max</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">tau</span>    <span class="o">=</span> <span class="n">Hmax</span> <span class="o">*</span> <span class="n">dt</span>

    <span class="c1"># Jn_tau = np.r_[j0(tau), 2 * (-1j)**np.arange(1,Npoly) * jv(range(1,Npoly), tau)]
</span>    <span class="n">Jn_tau</span> <span class="o">=</span> <span class="p">[</span><span class="n">j0</span><span class="p">(</span><span class="n">tau</span><span class="p">),</span> <span class="o">-</span><span class="mf">2j</span><span class="o">*</span><span class="n">j1</span><span class="p">(</span><span class="n">tau</span><span class="p">)]</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1j</span><span class="p">)</span><span class="o">**</span><span class="n">ii</span> <span class="o">*</span> <span class="n">jv</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span> <span class="n">tau</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">delta</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">Jn_tau</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tmp</span><span class="p">]</span>
        <span class="n">ii</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">Npoly</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Jn_tau</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Chebyshev expansion truncated at N = {}."</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">Npoly</span><span class="p">))</span>

    <span class="c1"># the external potential
</span>    <span class="n">V</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">diags</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="c1"># the kinetic operator
</span>    <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">spa</span><span class="p">.</span><span class="n">spdiags</span><span class="p">([</span><span class="n">O</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">O</span><span class="p">,</span> <span class="n">O</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">/</span> <span class="n">Hmax</span>

    <span class="c1"># Store all the wavefunctions
</span>    <span class="n">PSI_t</span>        <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="n">PSI_ShebyExp</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Npoly</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># the initial wavefunction
</span>    <span class="n">PSI_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span>
        <span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Npoly</span><span class="p">):</span>
            <span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="n">jj</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="n">jj</span><span class="p">]</span> <span class="o">-=</span> <span class="n">PSI_ShebyExp</span><span class="p">[:,</span><span class="n">jj</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> 

        <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">PSI_ShebyExp</span><span class="p">,</span> <span class="n">Jn_tau</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">print_norm</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">PSI_t</span>
</pre></td></tr></tbody></table></code></div></div>

<figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/comp_cn-chebyshev.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/comp_cn-chebyshev.gif" width="95%" />
    </a>
  </div>

  <figcaption style="text-align: center; padding: 10px">
    
    <b> Figure 9. </b>
    Propagation of Gaussian wavepacket from Crank-Nicolson and 
    Chebyshev polynomial expansion method with $N=11$.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn-cheby_comp_anim.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>

<h3 id="lanczos-method">Lanczos Method</h3>

<p>A different approach to approximately computing ${\cal U}(\Delta t)$ using only
the action of ${\cal H}$ on the wavefunction $\psi$ is the <em>Lanczos</em> method,
where a polynomial expansion is recursively created that builds an orthonormal
basis in the <em>M</em>th order Krylov subspace<sup id="fnref:krylovspace" role="doc-noteref"><a href="#fn:krylovspace" class="footnote">9</a></sup> spanned by $\lbrace\psi,
{\cal H}\psi, {\cal H}^2\psi,\ldots,{\cal H}^{M-1}\psi\rbrace$. The approximate
solution is then given by projection of the exact solution to the Krylov
subspace.<sup id="fnref:jcp2008" role="doc-noteref"><a href="#fn:jcp2008" class="footnote">10</a></sup></p>

<ul>
  <li>
    <p><strong>Krylov Subspace and Lanczos Basis.</strong> The <em>M</em>th order Krylov subspace with
respect to $\cal H$ and $\psi$ is</p>

\[{\cal K}_M({\cal H}, \psi) =  \mathrm{span}\,\{\psi, {\cal H}\psi, {\cal H}^2\psi,\ldots,{\cal H}^{M-1}\psi\}\]

    <p>that is, the space of all polynomials of $\cal H$ up to degree <em>M-1</em> acting on
$\psi$.</p>

    <p><strong>Gram-Schmidt orthogonalization</strong> is then used to build an orthonormal basis
of this space (<em>Lanczos basis</em>): starting with $v_1 = \psi / \|\psi\|$ (or
just $v_1 = \psi$ since $\psi$ is already normalized), it constructs $v_{k+1}$
recursively from $k=1,2,\ldots$ by orthogonzaling ${\cal H}\cdot v_k$ against
the previous $v_j$ and normalizing:</p>

\[\begin{align}
V_{k+1}   &amp;= {\cal H}\cdot v_k - \sum_{j=1}^k H^L_{j,k}\,v_j \\[6pt]
v_{k+1}   &amp;= V_{k+1} / \|V_{k+1}\| \\[9pt]
H^L_{j,k} &amp;= v_j^*\,{\cal H}\, v_k
\end{align}\]

    <p>By the <em>M</em>th step, the method generates <em>M</em> orthonormal Lanzcos basis vectors
$v_k$ and the <em>M</em>$\times$<em>M</em> matrix $H^L$.</p>

    <ul>
      <li>
        <p>Apparently, by multiplying $v_{k+1}^*$ and using the orthonormal conditions,
one can get</p>

\[\begin{equation}
H^L_{k+1,k}\,v_{k+1}
=
V_{k+1}
=
{\cal H}\cdot v_k - \sum_{j=1}^k H^L_{j,k}\,v_j
\end{equation}\]
      </li>
      <li>
        <p>One can also readily see that $H^L_{l,k} = 0$ for $l - k &gt; 1$, since</p>

\[\begin{equation}
H^L_{k+1,k}\,v^*_l\,v_{k+1} 
=
H^L_{l,k} - \sum_{j=1}^k H^L_{j,k}\,v^*_l\,v_j
=
0
\end{equation}\]
      </li>
      <li>
        <p>For an Hermite Hamiltonian ${\cal H}$, the matrix $H^L$ is also an Hermite
matrix, and since $H^L_{j,k} = 0$ for $j - k &gt; 1$, one can readily see that
$H^L$ is a <em>tridiagonal</em> Hermite matrix.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>One then project the Hamiltonian $\cal H$ and the wavefunction $\psi$ on the
Krylov subspace. The matrix representation of $\cal H$ is apparently $H^L$ and
the representation of the wavefunction $\psi$ in the Kyrlov subspace is a
column vector which can be expressed as</p>

\[e_\ell = \begin{pmatrix}1, 0, 0, \ldots, 0 \end{pmatrix}^T\]

    <p>The evolution of the wavefunction in the Krylov subspace can then be readily
written as</p>

\[\begin{align}
e^\ell(\Delta t) &amp;= e^{-iH^L\Delta t}\cdot e^\ell \\
     &amp;= U\, e^{-i E^L \Delta t} \, U^\dagger \cdot e^\ell
\end{align}\]

    <p>where $E^L$ is a diagonal matrix and $E^L = U^\dagger H^L U$.</p>
  </li>
  <li>
    <p>One can then get the wavefunction in the original space by linear combination
of the Lanczos basis. If we write the Lanczos basis as column vectors</p>

\[V_M =
\begin{pmatrix}v_1, v_2, v_3, \ldots, v_M\end{pmatrix}^T\]

    <p>then</p>

\[\psi(\Delta t) = e^\ell(\Delta t) \cdot V_m\]
  </li>
  <li>
    <p>To summarize, the Lanzcos method can be written as</p>

\[\psi(t+\Delta t) = e^{-i{\cal H}\Delta t}\cdot \psi(t) \approx V_M\cdot Ue^{-iE^L\Delta t}U^\dagger e_\ell\]

    <p><em>Apparently, the time step $\Delta t$ depends on the dimension of the Krylov
subspcae M, the larger the dimension M, the bigger the time step $\Delta t$.</em></p>

    <p>The <code class="language-plaintext highlighter-rouge">python</code> code implementation of the Lanczos method follows.</p>

    <div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">Lanczos</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">print_norm</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">'''
    Lanczos method for the 1D Schrodinger equation.
    '''</span>
    <span class="kn">from</span> <span class="nn">scipy.linalg</span> <span class="kn">import</span> <span class="n">eigh</span>
  
    <span class="c1"># No. of spatial grid points
</span>    <span class="n">J</span>  <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  
    <span class="c1"># the external potential
</span>    <span class="n">V</span> <span class="o">=</span> <span class="n">spa</span><span class="p">.</span><span class="n">diags</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="c1"># the kinetic operator
</span>    <span class="n">O</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">spa</span><span class="p">.</span><span class="n">spdiags</span><span class="p">([</span><span class="n">O</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">O</span><span class="p">,</span> <span class="n">O</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span>
  
    <span class="c1"># Store all the wavefunctions
</span>    <span class="n">PSI_t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># the initial wavefunction
</span>    <span class="n">PSI_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>
  
    <span class="c1"># orthonormal basis for the Krylov subspace
</span>    <span class="n">Vlanc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">J</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># Hamiltonian matrix in the Krylov subspace
</span>    <span class="n">Hlanc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span><span class="p">,</span> <span class="n">M</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># e1
</span>    <span class="n">e1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">r_</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
  
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Constructing:
</span>        <span class="c1"># 1. The Lanczos basis for the Krylov subspace: Vlanc
</span>        <span class="c1"># 2. The Hamiltonian matrix in the Lanczos basis: Hlanc
</span>        <span class="n">Vlanc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="n">Hlanc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">].</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">-</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">Hlanc</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">Vlanc</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
            <span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
  
            <span class="n">Hlanc</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">Hlanc</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">]</span>   <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">].</span><span class="n">conj</span><span class="p">()</span> <span class="o">*</span> <span class="n">H</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">[:,</span><span class="n">k</span><span class="p">]),</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">Hlanc</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Hlanc</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k</span><span class="p">].</span><span class="n">conj</span><span class="p">()</span>
  
        <span class="c1"># if n == 0:
</span>        <span class="c1">#     np.savetxt('hlanc.dat', np.abs(Hlanc))
</span>  
        <span class="c1"># Diagnolizing the matrix Hlanc and get the transformation matrix U, the
</span>        <span class="c1"># eigenvalues E
</span>        <span class="n">E</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">eigh</span><span class="p">(</span><span class="n">Hlanc</span><span class="p">)</span>
  
        <span class="c1"># evolving the wavefunction in the Krylov subspace
</span>        <span class="n">phi_lanc</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span>
            <span class="n">np</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">E</span><span class="p">)),</span> <span class="n">U</span><span class="p">.</span><span class="n">conj</span><span class="p">().</span><span class="n">T</span><span class="p">)),</span>
            <span class="n">e1</span>
        <span class="p">)</span>
        <span class="c1"># 
</span>        <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vlanc</span><span class="p">,</span> <span class="n">phi_lanc</span><span class="p">)</span>
  
        <span class="k">if</span> <span class="n">print_norm</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nb">abs</span><span class="p">(</span><span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
  
    <span class="k">return</span> <span class="n">PSI_t</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ul>

<figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/comp_cn-lanczos.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/comp_cn-lanczos.gif" width="95%" />
    </a>
  </div>

  <figcaption style="text-align: center; padding: 10px">
    
    <b> Figure 10. </b>
    Propagation of Gaussian wavepacket from Crank-Nicolson and Lanczos method
    with the dimension of Krylov space $M=15$. Note that a much larger time-step
    was used in the Lanczos method.
    Generated by 
    <a href="/assets/posts/numeric_tdse/cn-lanczos_comp_anim.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>
<h2 id="split-operator-techniques">Split-operator Techniques</h2>

<p>The split-operator technique approximates the unitary opertor by <em>Suzuki-Trotter</em>
expansion, for example, in second-order</p>

\[\begin{align}
{\cal U}(\Delta t)
    &amp;= e^{-i{\cal H} \Delta t} = e^{-i[\hat{T} + \hat{V}]\Delta t} \\[9pt]
    &amp;\approx e^{-i\hat{T}\Delta t /2} e^{-i\hat{V}{\Delta t}} e^{-i\hat{T}\Delta t /2}
        + {\cal O}(\Delta t^3) \label{eq:so-potential-ref} \\[9pt]
    &amp;\approx e^{-i\hat{V}\Delta t /2} e^{-i\hat{T}{\Delta t}} e^{-i\hat{V}\Delta t /2}
    + {\cal O}(\Delta t^3) \label{eq:so-kinetic-ref}
\end{align}\]

<p>It takes advantage of the fact that the Hamiltonian is composed of two terms:
the kinetic operator $\hat{T}$ being diagonal in <em>Fourier space</em> and the
potential operator being diagonal in <em>real space</em>. Since the three exponentials
can be computed exactly, it is <em>always unitary and unconditionally stable</em>,
providing a very reliable second-order method. Note that
Eq.\eqref{eq:so-potential-ref} and \eqref{eq:so-kinetic-ref} are equally
legitimate, with the former also being referred to as “potential referenced”
split-operator (potential operator sandwiched in the middle) and the latter
“kinetic referenced” one.</p>

<h3 id="integrating-the-schrödinger-equation">Integrating the Schrödinger Equation</h3>

<p>We will focus on the <em>“kinetic referenced”</em> split-operator in
\eqref{eq:so-kinetic-ref}, since the wavefunctions are represented on grid
points in <em>real space</em> and as a result we only have to perform <em>TWO</em> Fourier
transforms (FT) at each time evolution step.</p>

<p>The wavefunction and the potential are represented on $D$-dimensional grid
points with values on grid points being $\psi_j^n$ and $v_j$, where $j$ is the
index for the grid point and should again be considered as a compound index, for
example $(j, k, l)$ in 3D case. Let’s denote the wavefunction at time $t^n$ as
$\Psi^n$ and the potential as $V$, which are D-dimensional arrays themself.</p>

<p>Every time integration step consists of <em>three</em> sub-steps of successive
applicaton of the operator on the wavefunction:</p>

<ul>
  <li>
    <p>Acting potential operator on the wavefunction by <em>half time step</em>.</p>

\[\begin{equation}
    \Psi^{n, n+\frac{1}{2}} = \exp\left[
      -i\frac{\Delta t}{2} V
    \right]\cdot\Psi^{n}
\end{equation}\]

    <p>As we have stated, $V$ is diagonal in <em>real space</em> (<em>this does NOT mean that
$V$ is a diagonal matrix</em>), the $\cdot$ operation thus represents <em>elementwise
multiplicaton</em> of the two arrays: $\exp[-i\frac{\Delta t}{2}\Psi^n]$ and $V$.</p>
  </li>
  <li>
    <p>Acting the kinetic operator on the wavefunction by <em>one full time step</em>.</p>

\[\begin{equation}
    \Psi^{n+1, n+\frac{1}{2}} = 
    {\cal F}^{-1}\left[
        \exp\bigl[
          -i\Delta t T
        \bigr]
        \cdot
        {\cal F}\bigl[\Psi^{n, n+\frac{1}{2}}\bigr]
    \right]
\end{equation}\]

    <p>where ${\cal F}$ and ${\cal F}^{-1}$ means FT and inverse FT, repsectively.
The kinetic operator is diagonal in <em>Fourier space</em> and is simply the kinetic
energy of the plane waves $k^2 / 2$. The $\cdot$ operation is also an
elementwise matrix multiplicaton.</p>
  </li>
  <li>
    <p>Acting potential operator on the wavefunction by another <em>half time step</em>.</p>

\[\begin{equation}
    \Psi^{n+1} = \exp\left[
      -i\frac{\Delta t}{2} V
    \right]
    \cdot
    \Psi^{n+1, n+\frac{1}{2}}
\end{equation}\]
  </li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">python</code> code for split-opertor method is shown below.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre><span class="k">def</span> <span class="nf">SplitOperatorKin</span><span class="p">(</span><span class="n">psi0</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="s">'''
    Splitting technique for evolving the time-dependent Schrodinger equation.

    Kinetic referenced second-order Suzuki-Trotter expansion is used.
    '''</span>

    <span class="kn">from</span> <span class="nn">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span><span class="p">,</span> <span class="n">fftfreq</span>

    <span class="n">psi0</span>  <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
    <span class="n">V</span>     <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">ngrid</span> <span class="o">=</span> <span class="n">V</span><span class="p">.</span><span class="n">shape</span>
    <span class="k">assert</span> <span class="n">V</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">V</span><span class="p">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">psi0</span><span class="p">.</span><span class="n">shape</span>

    <span class="c1"># the kinetic operator
</span>    <span class="n">ff</span> <span class="o">=</span> <span class="p">[</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">V</span><span class="p">.</span><span class="n">shape</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">V</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">V</span><span class="p">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">kx</span><span class="p">,</span> <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ff</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">L</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> \
             <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">ky</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span><span class="p">(</span><span class="nb">NotImplementedError</span><span class="p">)</span>

    <span class="c1"># the kinetic operator by one time step
</span>    <span class="c1"># k**2 / 2 is the kinetic energy of the plane waves
</span>    <span class="n">Ut_full</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">k2</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

    <span class="c1"># the potential operator by half time step
</span>    <span class="n">Uv_half</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">V</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>

    <span class="c1"># Store all the wavefunctions
</span>    <span class="n">PSI_t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">psi0</span><span class="p">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
    <span class="c1"># the initial wavefunction
</span>    <span class="n">PSI_t</span><span class="p">[...,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">psi0</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">PSI_t</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uv_half</span> <span class="o">*</span>\
            <span class="n">ifft</span><span class="p">(</span>
                <span class="n">Ut_full</span> <span class="o">*</span> <span class="n">fft</span><span class="p">(</span>
                    <span class="n">Uv_half</span> <span class="o">*</span> <span class="n">PSI_t</span><span class="p">[...,</span> <span class="n">n</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">PSI_t</span>
</pre></td></tr></tbody></table></code></div></div>

<p>In the figure below, we have applied both the Crank-Nicolson and Split-operator
method on the propagation of 1D Gaussian wavepacket, with the external potential
being $0$ for $x\in[0,L]$. The average momentum of the packet $k_0$ was set to
be 5 a.u.</p>

<figure>
  <div align="center">
    <a href="/assets/posts/numeric_tdse/comp_cn-so.gif" data-lightbox="roadtrip">
      <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/posts/numeric_tdse/comp_cn-so.gif" width="95%" />
    </a>
  </div>

  <figcaption style="text-align: center; padding: 10px">
    
    <b> Figure 11. </b>
    Propagation of Gaussian wavepacket from Crank-Nicolson and split-operator
    method.
    Generated by 
    <a href="/assets/posts/numeric_tdse/so-cn_comp_anim.py">
    matplotlib animation.
    </a>
  </figcaption>
</figure>

<p>As can be clearly seen</p>

<ul>
  <li>
    <p>For time $t \lesssim 0.8$ a.u., when the wavepacket is about to hit the
boundary, the results from the two methods match reasonably well.
Afterwards, the two methods start to differ significantly.</p>
  </li>
  <li>
    <p>The reason lies in the fact that we are using <em>zero-boundary condition</em> in
Crank-Nicolson method, as we have stated, while in the split-operator method
we are implicitly adopting <em>periodic-boundary condition</em> when we performed
<em>Fourier transform</em>.  One can see that the wavefunction at both ends of the
boundary from split-operator method are roughly the same.  Before the
wavefunction hits the boundary, the wavefucntion at both ends of the
boundaries are <em>zero</em>, which does make a difference for the two boundary
conditions.</p>
  </li>
</ul>

<h2 id="references">References</h2>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:atomic_unit" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Hartree_atomic_units" target="_blank">Hartree Atomic Unit</a> <a href="#fnref:atomic_unit" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:cranknicolson" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Crank%E2%80%93Nicolson_method" target="_blank">Crank–Nicolson method </a> <a href="#fnref:cranknicolson" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:finite_diff" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Finite_difference" target="_blank">Finite difference: second-order central</a> <a href="#fnref:finite_diff" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:wavepacket" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Wave_packet#Gaussian_wave_packets_in_quantum_mechanics" target="_blank">Wave packet</a> <a href="#fnref:wavepacket" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:qmsolve" role="doc-endnote">
      <p><a href="https://github.com/quantum-visualizations/qmsolve" target="_blank">QMsolve: A module for solving and visualizing the Schrödinger equation</a> <a href="#fnref:qmsolve" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:rungekutta" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods" target="_blank">Runge-Kutta Method</a> <a href="#fnref:rungekutta" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:chebyshev" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Chebyshev_polynomials" target="_blank">Chebyshev polynomials</a> <a href="#fnref:chebyshev" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:scipy_bessel_jv" role="doc-endnote">
      <p><a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.special.jv.html" target="_blank">scipy.special.jv</a> <a href="#fnref:scipy_bessel_jv" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:krylovspace" role="doc-endnote">
      <p><a href="https://en.wikipedia.org/wiki/Krylov_subspace" target="_blank">Krylov Subspace</a> <a href="#fnref:krylovspace" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:jcp2008" role="doc-endnote">
      <p><a href="https://aip.scitation.org/doi/full/10.1063/1.2916581" target="_blank">Accurate time propagation for the Schrödinger equation with an explicitly time-dependent Hamiltonian</a> <a href="#fnref:jcp2008" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>


      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
        
        <div class="post-meta mb-3">
          <i class="far fa-folder-open fa-fw mr-1"></i>
          
            <a href='/categories/blogging/'>Blogging</a>,
            <a href='/categories/tutorial/'>Tutorial</a>
        </div>
        

        <!-- tags -->
        
        <div class="post-tags">
          <i class="fa fa-tags fa-fw mr-1"></i>
          
          <a href="/tags/schrodingerequation/"
            class="post-tag no-text-decoration" >SchrodingerEquation</a>
          
          <a href="/tags/quantummechanics/"
            class="post-tag no-text-decoration" >QuantumMechanics</a>
          
          <a href="/tags/scipy/"
            class="post-tag no-text-decoration" >Scipy</a>
          
          <a href="/tags/python/"
            class="post-tag no-text-decoration" >Python</a>
          
          </div>
        

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          
          <div class="license-wrapper">
            This post is licensed under
            <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>
            by the author.
          </div>
          

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://twitter.com/intent/tweet?text=Numerical Solutions to the Time-dependent Schrödinger Equation - Qijing Zheng&url=https://qijingzheng.github.io/posts/Numerical_TDSE/" data-toggle="tooltip" data-placement="top"
          title="Twitter" target="_blank" rel="noopener" aria-label="Twitter">
          <i class="fa-fw fab fa-twitter"></i>
        </a>
    
      
        <a href="https://www.facebook.com/sharer/sharer.php?title=Numerical Solutions to the Time-dependent Schrödinger Equation - Qijing Zheng&u=https://qijingzheng.github.io/posts/Numerical_TDSE/" data-toggle="tooltip" data-placement="top"
          title="Facebook" target="_blank" rel="noopener" aria-label="Facebook">
          <i class="fa-fw fab fa-facebook-square"></i>
        </a>
    
      
        <a href="https://telegram.me/share?text=Numerical Solutions to the Time-dependent Schrödinger Equation - Qijing Zheng&url=https://qijingzheng.github.io/posts/Numerical_TDSE/" data-toggle="tooltip" data-placement="top"
          title="Telegram" target="_blank" rel="noopener" aria-label="Telegram">
          <i class="fa-fw fab fa-telegram"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink()"
        data-toggle="tooltip" data-placement="top" title="Copy link"></i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->

<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

    <div id="access-lastmod" class="post">
      <span>Recent Update</span>
      <ul class="post-content pl-0 pb-1 ml-1 mt-2">

      
        
        
        
        <li><a href="/posts/Light-Matter-Interaction-and-Dipole-Transition-Matrix/">Light-Matter Interaction and Dipole Transition Matrix</a></li>
      
        
        
        
        <li><a href="/posts/VASP-All-Electron-WFC/">PAW All-Electron Wavefunction in VASP</a></li>
      
        
        
        
        <li><a href="/posts/Plotly-Spherical-Harmonics/">Plotly: Spherical Harmonics</a></li>
      
        
        
        
        <li><a href="/posts/Overlap-Integral-in-Momentum-Space/">Evaluating Overlap Integral in Momentum Space</a></li>
      
        
        
        
        <li><a href="/posts/FourierTransform-Radial-Function/">Fourier Transform of Radial Functions</a></li>
      

      </ul>
    </div> <!-- #access-lastmod -->

  

  















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



  
    <div id="access-tags">
      <span>Trending Tags</span>
      <div class="d-flex flex-wrap mt-3 mb-1 mr-3">

      
        
        <a class="post-tag" href="/tags/python/">Python</a>
      
        
        <a class="post-tag" href="/tags/matplotlib/">Matplotlib</a>
      
        
        <a class="post-tag" href="/tags/vasp/">VASP</a>
      
        
        <a class="post-tag" href="/tags/plotly/">Plotly</a>
      
        
        <a class="post-tag" href="/tags/sphericalharmonics/">SphericalHarmonics</a>
      
        
        <a class="post-tag" href="/tags/tikz/">TikZ</a>
      
        
        <a class="post-tag" href="/tags/phonon/">Phonon</a>
      
        
        <a class="post-tag" href="/tags/phonopy/">Phonopy</a>
      
        
        <a class="post-tag" href="/tags/plotting/">Plotting</a>
      
        
        <a class="post-tag" href="/tags/brillouinzone/">BrillouinZone</a>
      

      </div>
    </div>
  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <!-- <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap&#45;toc@1.0.1/dist/bootstrap&#45;toc.min.js"></script> -->
    <script src='/assets/js/dist/bootstrap-toc.js'></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

    <!--
 Recommend the other 3 posts according to the tags and categories of the current post,
 if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts  -->


<!-- An random integer that bigger than 0  -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy}  -->








  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  
    
  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  


  

  

  

  

  

  








<!-- Fill with the other newlest posts  -->






  <div id="related-posts" class="mt-5 mb-2 mb-sm-4">
    <h3 class="pt-2 mt-1 mb-4 ml-1"
      data-toc-skip>Further Reading</h3>
    <div class="card-deck mb-4">
    
      
      
      <div class="card">
        <a href="/posts/Numerov-Algorithm/">
          <div class="card-body">
            <!--
  Date format snippet
-->





<span class="timeago small"
  >

  
  

  
    May  7, 2021
  

  <i class="unloaded">2021-05-07T11:30:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Numerov Algorithm</h3>
            <div class="text-muted small">
              <p>
                





                Numerov’s method

Numerov’s method1 (also called Cowell’s method) is a numerical
method to solve ordinary differential equations of second order in which the
first-order term does not appear. It is...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/Phonopy-Rutile-TiO2/">
          <div class="card-body">
            <!--
  Date format snippet
-->





<span class="timeago small"
  >

  
  

  
    Apr 25
  

  <i class="unloaded">2022-04-25T09:30:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Phonopy: Rutile TiO<sub>2</sub></h3>
            <div class="text-muted small">
              <p>
                





                Phonon Dispersion of Rutile TiO$_2$

This is a summary of my using Phonopy to
calculate phonon spectrum of rutile TiO$_2$. 1

Computational Details

Below is a list of used packages and computation...
              </p>
            </div>
          </div>
        </a>
      </div>
    
      
      
      <div class="card">
        <a href="/posts/LinearTetrahedronMethod/">
          <div class="card-body">
            <!--
  Date format snippet
-->





<span class="timeago small"
  >

  
  

  
    May  4
  

  <i class="unloaded">2022-05-04T14:30:00+08:00</i>

</span>

            <h3 class="pt-0 mt-1 mb-3" data-toc-skip>Brillouin Zone Integration: Linear Tetrahedron Method</h3>
            <div class="text-muted small">
              <p>
                





                Introduction

The translational symmetry of solids resulits in a quantum number, i.e.  the
crystal momentum $\mathbf{k}$.  Consequently many quantities of the crystal,
e.g. total energy and density...
              </p>
            </div>
          </div>
        </a>
      </div>
    
    </div> <!-- .card-deck -->
  </div> <!-- #related-posts -->



    <!--
  Navigation buttons at the bottom of the post.
-->

<div class="post-navigation d-flex justify-content-between">
  
  <a href="/posts/BravaisLattice3D/" class="btn btn-outline-primary"
    prompt="Older">
    <p>Bravais Lattice</p>
  </a>
  

  
  <a href="/posts/GeneralWignerCrystal/" class="btn btn-outline-primary"
    prompt="Newer">
    <p>General Wigner Crystal in Moiré Superlattice</p>
  </a>
  

</div>


    

    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



  <!--
  image lazy load: https://github.com/ApoorvSaxena/lozad.js
-->
<!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> -->
<script type="text/javascript" src='/assets/js/dist/lozad.min.js'></script>

<script type="text/javascript">
  const imgs = document.querySelectorAll('.post-content img');
  const observer = lozad(imgs);
  observer.observe();
</script>




        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2022
        <a href="https://github.com/QijingZheng">Qijing Zheng</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        Powered by
        <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
        with
        <a href="https://github.com/cotes2020/jekyll-theme-chirpy"
          target="_blank" rel="noopener">Chirpy</a>
        theme.
      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        



      
        
        <a class="post-tag" href="/tags/python/">Python</a>
      
        
        <a class="post-tag" href="/tags/matplotlib/">Matplotlib</a>
      
        
        <a class="post-tag" href="/tags/vasp/">VASP</a>
      
        
        <a class="post-tag" href="/tags/plotly/">Plotly</a>
      
        
        <a class="post-tag" href="/tags/sphericalharmonics/">SphericalHarmonics</a>
      
        
        <a class="post-tag" href="/tags/tikz/">TikZ</a>
      
        
        <a class="post-tag" href="/tags/phonon/">Phonon</a>
      
        
        <a class="post-tag" href="/tags/phonopy/">Phonopy</a>
      
        
        <a class="post-tag" href="/tags/plotting/">Plotting</a>
      
        
        <a class="post-tag" href="/tags/brillouinzone/">BrillouinZone</a>
      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<!-- <script src="https://cdn.jsdelivr.net/npm/simple&#45;jekyll&#45;search@1.7.3/dest/simple&#45;jekyll&#45;search.min.js"></script> -->
<script src='/assets/js/dist/simple-jekyll-search.min.js'></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://QijingZheng.github.io{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


  </body>

</html>

